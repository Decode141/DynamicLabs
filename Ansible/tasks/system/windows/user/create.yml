---
# Create local user
#
# Parameters:
# name = user name (required)
# passowrd = user password. Autogenerated if not specified.
# enabled = yes (default), no
# 
# Example:
#            {
#                name = "Win_User"
#                value = [
#                    {name = "LocalUser1"}, # Local user with random password
#                    {name = "LocalUser2"}, # Local user disabled
#                    {name = "LocalUser3", password = "Welcome123!!", full_name = "Such and such"} # Local user with password and fullname
#                  ]
#            }
# Legacy DEPRECATED syntax:
#   {name = "username", value = "LocalUser"},

- win_user:
    # Keep backward compatibility with deprecated syntax
    name: "{{ item.value | default(item.name) }}"
    password: "{{ item.password | default(lookup('password', '~/credentials/local/' + custom_hostname + '/' + (item.value | default(item.name)) + ' chars=ascii_letters,digits,punctuation length=12')) }}"
    password_never_expires: "{{ item.password_never_expires | default('yes') }}"
    fullname: "{{ item.full_name | default('') }}"
    state: present
    account_disabled: "{{ 'yes' if ((item.enabled | default('yes')) == 'no') else 'no' }}"
    groups: Users